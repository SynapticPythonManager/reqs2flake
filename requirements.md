
# example usage #run the file we are in

We have `reqs2flake.sh` this way we have the full requirements we need from uv and the user 
only has to touch requirements.bak.txt

The user will Prepare environment with:

```bash
path/to/reqs2flake.sh somedir
```

enter the environment with:

```bash
cd somedir
nix develop --impure
```

### When things work imports should work

```bash
python3 -c "import numpy; print(numpy.__version__)"
1.26.4
python somefile.py
```

We are automating the creation of flakes from reqs
We ARE NOT providing an app we are only providing a shell invronment.

```
gym==0.23.1
matplotlib==3.5.2
numpy==1.18.0
stable_baselines3==1.2.0
torch==1.10.1
tqdm==4.64.1
```

Trying to setup a reproducible workflow where the user only has to manage versioning of the packages in the style above instead of the style below with 400 lines requirements that is needed to create a lock file for the environment they are importing:

```
# This file was autogenerated by uv via the following command:
#    uv pip compile requirements.bak.txt -o requirements.txt
cloudpickle==3.1.1
    # via
    #   gym
    #   stable-baselines3
contourpy==1.3.3

... 400 lines for user to read here ...

typing-extensions==4.15.0
    # via torch
tzdata==2025.2
    # via pandas
```

### current output
[owner@nixos:~/sync/reqs2flake]$  ./reqs2flake.sh
+ mkdir /home/owner/sync/reqs2flake/numtest
+ cd /home/owner/sync/reqs2flake/numtest
+ cat
+ cat
+ exit
+ cd /home/owner/sync/reqs2flake/numtest
+ [[ ! -f requirements.bak.txt ]]
+ uv pip compile requirements.bak.txt -o requirements.txt --upgrade --prerelease=allow
Resolved 1 package in 185ms
# This file was autogenerated by uv via the following command:
#    uv pip compile requirements.bak.txt -o requirements.txt --prerelease=allow
numpy==1.26.4
    # via -r requirements.bak.txt
+ '[' -f flake.nix ']'
+ cat
+ gen_toml
+ set -euo pipefail
++ cat requirements.bak.txt
++ sed 's/^/"/; s/$/",/'
++ tr '\n' '\n'
+ deps='"numpy == 1.26.4",'
+ cat
+ echo '>>> generating uv.lock with CPU-only Torch'
>>> generating uv.lock with CPU-only Torch
+ uv lock --upgrade
Using CPython 3.12.11 interpreter at: /run/current-system/sw/bin/python3
Resolved 2 packages in 332ms
+ cd /home/owner/sync/reqs2flake/numtest
+ '[' '!' -d .git ']'
+ echo '>>> Initializing local git repo for flake'
>>> Initializing local git repo for flake
+ git init -b main
Initialized empty Git repository in /home/owner/sync/reqs2flake/numtest/.git/
+ git add flake.nix pyproject.toml uv.lock requirements.bak.txt
+ git commit -m 'init local flake'
[main (root-commit) 6d7e656] init local flake
 4 files changed, 126 insertions(+)
 create mode 100644 flake.nix
 create mode 100644 pyproject.toml
 create mode 100644 requirements.bak.txt
 create mode 100644 uv.lock
+ exit

[owner@nixos:~/sync/reqs2flake]$ cd ./numtest

[owner@nixos:~/sync/reqs2flake/numtest]$ nix develop --impure
warning: creating lock file '"/home/owner/sync/reqs2flake/numtest/flake.lock"': 
• Added input 'flake-utils':
    'github:numtide/flake-utils/11707dc2f618dd54ca8739b309ec4fc024de578b?narHash=sha256-l0KFg5HjrsfsO/JpG%2Br7fRrqm12kzFHyUHqHCVpMMbI%3D' (2024-11-13)
• Added input 'flake-utils/systems':
    'github:nix-systems/default/da67096a3b9bf56a91d16901293e51ba5b49a27e?narHash=sha256-Vy1rq5AaRuLzOxct8nz4T6wlgyUR7zLU309k9mBC768%3D' (2023-04-09)
• Added input 'nixpkgs':
    'github:NixOS/nixpkgs/2fb006b87f04c4d3bdf08cfdbc7fab9c13d94a15?narHash=sha256-kJ8lIZsiPOmbkJypG%2BB5sReDXSD1KGu2VEPNqhRa/ew%3D' (2025-10-31)
• Added input 'pyproject-build-systems':
    'github:pyproject-nix/build-system-pkgs/795a980d25301e5133eca37adae37283ec3c8e66?narHash=sha256-YDvxPAm2WnxrznRqWwHLjryBGG5Ey1ATEJXrON%2BTWt8%3D' (2025-10-29)
• Added input 'pyproject-build-systems/nixpkgs':
    follows 'nixpkgs'
• Added input 'pyproject-build-systems/pyproject-nix':
    follows 'pyproject-nix'
• Added input 'pyproject-build-systems/uv2nix':
    'github:pyproject-nix/uv2nix/273ce18f913d8559e0d04f820d724308966d7c4d?narHash=sha256-HAmm1GBS1myZCFuog0DC2ZLaynvZtiUI2Crmo%2BcdQI0%3D' (2025-09-27)
• Added input 'pyproject-build-systems/uv2nix/nixpkgs':
    follows 'pyproject-build-systems/nixpkgs'
• Added input 'pyproject-build-systems/uv2nix/pyproject-nix':
    follows 'pyproject-build-systems/pyproject-nix'
• Added input 'pyproject-nix':
    'github:pyproject-nix/pyproject.nix/84c4ea102127c77058ea1ed7be7300261fafc7d2?narHash=sha256-jF6UKLs2uGc2rtved8Vrt58oTWjTQoAssuYs/0578Z4%3D' (2025-10-14)
• Added input 'pyproject-nix/nixpkgs':
    follows 'nixpkgs'
• Added input 'uv2nix':
    'github:pyproject-nix/uv2nix/74dfb62871be152ad3673b143b0cc56105a4f3c5?narHash=sha256-i25GRgp2vUOebY70L3NTAgkd%2BPr1hnn5xM3qHxH0ONU%3D' (2025-10-31)
• Added input 'uv2nix/nixpkgs':
    follows 'nixpkgs'
• Added input 'uv2nix/pyproject-nix':
    follows 'pyproject-nix'

[owner@nixos:~/sync/reqs2flake/numtest]$ python3 -c "import numpy; print(numpy.__version__)"
1.26.4

